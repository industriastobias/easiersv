<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gestión de Compras</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        :root {
            --bg: #0d1117;
            --panel: #161b22;
            --card: #1e242e;
            --accent: #22d3ee;
            --danger: #f43f5e;
            --text: #e6edf3;
            --muted: #8b949e;
            --border: #30363d;
            --radius: 14px;
            --shadow: 0 8px 24px rgba(0, 0, 0, .4);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', system-ui, sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: 260px;
            background: var(--panel);
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
            border-right: 1px solid var(--border);
            animation: slideIn .4s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
        }

        .sidebar .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent);
            letter-spacing: 1px;
            text-align: center;
        }

        .sidebar .links {
            display: flex;
            flex-direction: column;
            gap: .75rem;
        }

        .sidebar .links a {
            display: flex;
            align-items: center;
            gap: .75rem;
            padding: .75rem 1rem;
            border-radius: var(--radius);
            text-decoration: none;
            color: var(--text);
            font-weight: 500;
            transition: background .2s, color .2s;
        }

        .sidebar .links a:hover {
            background: rgba(255, 255, 255, .05);
        }

        .sidebar .links a.active {
            background: var(--accent);
            color: #000;
        }

        /* MAIN */
        main {
            flex: 1;
            padding: 2rem 3rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
            overflow-y: auto;
        }

        .topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .topbar h1 {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .content {
            display: flex;
            gap: 2rem;
            flex: 1;
        }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 2rem;
            animation: fadeUp .5s ease-out;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
        }

        .form-card {
            width: 320px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-card h2 {
            margin-bottom: .5rem;
            font-size: 1.25rem;
            color: var(--accent);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: .5rem;
        }

        label {
            font-size: .9rem;
            color: var(--muted);
        }

        input, select, textarea {
            padding: .75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--panel);
            color: var(--text);
            transition: border-color .2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        button {
            padding: .75rem 1rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background .2s, transform .2s;
        }

        button.primary {
            background: var(--accent);
            color: #000;
        }

        button.primary:hover {
            background: #1be0e0;
            transform: translateY(-2px);
        }

        button.danger {
            background: var(--danger);
            color: #fff;
        }

        button.danger:hover {
            background: #e11d48;
        }

        .table-card {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: .9rem;
        }

        th, td {
            padding: .75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            color: var(--accent);
            font-weight: 600;
        }

        tr:hover {
            background: rgba(255, 255, 255, .03);
        }

        .total-card {
            align-self: flex-start;
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--accent);
            color: #000;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            animation: fadeUp .6s ease-out;
        }

        .total-card i {
            font-size: 1.5rem;
        }

        .total-card div p:first-child {
            font-weight: 600;
            margin: 0;
        }

        .total-card div p:last-child {
            font-size: 1.5rem;
            font-weight: 800;
            margin: 0;
        }

        /* Scroll personalizado */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }
    </style>
</head>
<body>

<aside class="sidebar">
    <div class="logo">AESIER</div>
    <nav class="links">
        <a href="compra.html" class="active"><i class="fa-solid fa-cart-plus"></i> Compras</a>
        <a href="venta.html"><i class="fa-solid fa-cash-register"></i> Ventas</a>
        <a href="inventario.html"><i class="fa-solid fa-boxes-stacked"></i> Inventario</a>
        <a href="clientes.html"><i class="fa-solid fa-users"></i> Clientes</a>
    </nav>
</aside>

<main>
    <div class="topbar">
        <h1>Gestión de Compras</h1>
    </div>

    <div class="content">
        <section class="card form-card">
            <h2>Alta de producto</h2>
            <form id="purchaseForm">
                <div class="form-group">
                    <label>Nombre del Producto:</label>
                    <input type="text" id="name" name="name" required />
                </div>
                <div class="form-group">
                    <label>Código:</label>
                    <input type="text" id="code" name="code" required />
                </div>
                <div class="form-group">
                    <label>Código de Barras:</label>
                    <input type="text" id="barcode" name="barcode" />
                </div>
                <div class="form-group">
                    <label>Precio:</label>
                    <input type="number" id="price" name="price" step="0.01" required />
                </div>
                <div class="form-group">
                    <label>Descuento (%):</label>
                    <input type="number" id="discount" name="discount" step="0.01" value="0" />
                </div>
                <div class="form-group">
                    <label>Descripción:</label>
                    <textarea id="description" name="description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Categoría:</label>
                    <select id="category" name="category">
                        <option value="Aritos">Aritos</option>
                        <option value="Billeteras">Billeteras</option>
                        <option value="Carteras">Carteras</option>
                        <option value="Chokers">Chokers</option>
                        <option value="Collares">Collares</option>
                        <option value="Lentes de sol">Lentes de sol</option>
                        <option value="Pulseras">Pulseras</option>
                        <option value="Relojes">Relojes</option>
                        <option value="Anillos">Anillos</option>
                        <option value="Accesorios para el cabello">Accesorios para el cabello</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Cantidad en Stock:</label>
                    <input type="number" id="quantity" name="quantity" required />
                </div>
                <button type="submit" class="primary">Guardar</button>
            </form>

            <input type="file" id="importFile" accept=".xlsx, .xls" style="display: none;" onchange="importFromExcel(event)" />
            <button onclick="document.getElementById('importFile').click()" class="primary">Importar Excel</button>
            <button onclick="exportToExcel()" class="primary">Exportar Excel</button>
            <button onclick="vaciarInventario()" class="danger">Vaciar Inventario</button>
        </section>

        <section class="card table-card">
            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Código</th>
                        <th>Código de Barras</th>
                        <th>Precio</th>
                        <th>Descuento</th>
                        <th>Descripción</th>
                        <th>Categoría</th>
                        <th>Stock</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="inventoryList"></tbody>
            </table>
        </section>
    </div>

    <div class="total-card">
        <i class="fa-solid fa-dollar-sign"></i>
        <div>
            <p>Total en USD</p>
            <p id="totalAmount">$0.00</p>
        </div>
    </div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
<script>
    /* ==========  LÓGICA ORIGINAL (SIN TOCAR)  ========== */
    let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
    let editIndex = -1;

    function calculateTotal() {
        const total = inventory.reduce((sum, item) => {
            const price = parseFloat(item.price) || 0;
            const quantity = parseFloat(item.quantity) || 0;
            return sum + price * quantity;
        }, 0);
        document.getElementById('totalAmount').textContent = `$${total.toFixed(2)}`;
    }

    function renderTable() {
        const list = document.getElementById('inventoryList');
        list.innerHTML = inventory.map((item, idx) => `
            <tr>
                <td>${item.name}</td>
                <td>${item.code}</td>
                <td>${item.barcode}</td>
                <td>$${item.price}</td>
                <td>${item.discount}%</td>
                <td>${item.description}</td>
                <td>${item.category}</td>
                <td>${item.quantity}</td>
                <td>
                    <button onclick="editItem(${idx})" class="primary">Editar</button>
                    <button onclick="deleteItem(${idx})" class="danger">Eliminar</button>
                </td>
            </tr>
        `).join('');
    }

    document.getElementById('purchaseForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const newItem = Object.fromEntries(new FormData(e.target).entries());
        editIndex === -1 ? inventory.push(newItem) : (inventory[editIndex] = newItem);
        localStorage.setItem('inventory', JSON.stringify(inventory));
        e.target.reset();
        editIndex = -1;
        renderTable();
        calculateTotal();
    });

    function editItem(index) {
        const item = inventory[index];
        Object.keys(item).forEach(k => document.getElementById(k).value = item[k]);
        editIndex = index;
    }

    function deleteItem(index) {
        if (confirm('¿Eliminar producto?')) {
            inventory.splice(index, 1);
            localStorage.setItem('inventory', JSON.stringify(inventory));
            renderTable();
            calculateTotal();
        }
    }

    function vaciarInventario() {
        if (confirm('¿Vaciar todo el inventario?')) {
            inventory = [];
            localStorage.setItem('inventory', JSON.stringify(inventory));
            renderTable();
            calculateTotal();
        }
    }

    function exportToExcel() {
        const ws = XLSX.utils.json_to_sheet(inventory);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Inventario");
        XLSX.writeFile(wb, "inventario.xlsx");
    }

    function importFromExcel(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = e => {
            const wb = XLSX.read(e.target.result, { type: 'binary' });
            const sheet = wb.Sheets[wb.SheetNames[0]];
            const json = XLSX.utils.sheet_to_json(sheet);
            inventory = inventory.concat(json);
            localStorage.setItem('inventory', JSON.stringify(inventory));
            renderTable();
            calculateTotal();
            alert("Importación completada");
        };
        reader.readAsBinaryString(file);
    }

    window.addEventListener("beforeunload", () => localStorage.setItem('inventory', JSON.stringify(inventory)));

    renderTable();
    calculateTotal();
</script>

</body>
</html>
