<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ventas ‚Ä¢ Tobias</title>
  <style>
    :root {
      --bg: #fafafa;
      --card: #ffffff;
      --text: #1f1f1f;
      --line: #e5e7eb;
      --accent: #6b7280;
    }
    [data-theme="dark"] {
      --bg: #0a0a0a;
      --card: #111111;
      --text: #f0f0f0;
      --line: #27272a;
      --accent: #9ca3af;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    html, body {
      height: 100%;
      background: var(--bg);
      color: var(--text);
      transition: background .3s, color .3s;
    }
    body {
      display: flex;
      flex-direction: column;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 2rem;
      border-bottom: 1px solid var(--line);
    }
    header h1 {
      font-size: 1.25rem;
      font-weight: 600;
      letter-spacing: .5px;
    }
    .actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    input[type="search"] {
      padding: .5rem .75rem;
      border-radius: 6px;
      border: 1px solid var(--line);
      background: var(--bg);
      color: var(--text);
      width: 200px;
    }
    button.icon {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 1.1rem;
      cursor: pointer;
      transition: color .2s;
    }
    button.icon:hover {
      color: var(--text);
    }
    main {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }
    .grid {
      display: grid;
      gap: 1.5rem;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: .75rem;
    }
    .form-row input {
      flex: 1 1 160px;
      padding: .75rem 1rem;
      border: 1px solid var(--line);
      border-radius: 8px;
      background: var(--bg);
      color: var(--text);
      font-size: .95rem;
      outline: none;
      transition: border-color .2s;
    }
    .form-row input:focus {
      border-color: var(--accent);
    }
    .btn-primary {
      align-self: flex-start;
      padding: .65rem 1.25rem;
      border-radius: 8px;
      border: none;
      background: var(--accent);
      color: var(--card);
      font-weight: 500;
      cursor: pointer;
      transition: opacity .2s;
    }
    .btn-primary:hover {
      opacity: .85;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: .95rem;
    }
    th, td {
      padding: .75rem 1rem;
      text-align: left;
      border-bottom: 1px solid var(--line);
    }
    th {
      cursor: pointer;
      user-select: none;
      font-weight: 600;
      color: var(--accent);
    }
    th:hover {
      color: var(--text);
    }
    .total-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1rem;
      font-weight: 500;
    }
    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: var(--card);
      border: 1px solid var(--line);
      padding: .75rem 1.25rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,.1);
      opacity: 0;
      transform: translateY(10px);
      transition: opacity .3s, transform .3s;
      pointer-events: none;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    @media (max-width: 600px) {
      header {
        flex-direction: column;
        gap: 1rem;
      }
      input[type="search"] {
        width: 100%;
      }
    }
  </style>
</head>
<body data-theme="light">

<header>
  <h1>Ventas ‚Ä¢ Tobias</h1>
  <div class="actions">
    <input type="search" id="search" placeholder="Buscar..." />
    <button class="icon" onclick="exportExcel()" title="Exportar Excel">‚¨á</button>
    <button class="icon" onclick="exportDocx()" title="Exportar DOCX">üìù</button>
    <button class="icon" onclick="copyTable()" title="Copiar tabla">üìã</button>
    <button class="icon" onclick="clearAll()" title="Vaciar lista">üóë</button>
    <button class="icon" onclick="toggleTheme()" title="Cambiar tema">‚óã</button>
  </div>
</header>

<main>
  <div class="grid">
    <!-- Tabla + total -->
    <div class="card" style="grid-column:1/-1">
      <table id="table">
        <thead>
          <tr>
            <th onclick="sortTable(0)">Producto</th>
            <th onclick="sortTable(1)">C√≥digo</th>
            <th onclick="sortTable(2)">Precio</th>
            <th onclick="sortTable(3)">Cantidad</th>
            <th onclick="sortTable(4)">Total</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="list"></tbody>
      </table>
      <div class="total-bar">
        <span>Total general</span>
        <span id="total">$0.00</span>
      </div>
    </div>
  </div>
</main>

<div class="toast" id="toast"></div>

<script>
  /* ----------  UTILS  ---------- */
  function toggleTheme() {
    document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light');
  }
  function toast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2000);
  }

  /* ----------  DATA  ---------- */
  let data = JSON.parse(localStorage.getItem('ventas')) || [];
  let sortDirection = true;

  function save() {
    localStorage.setItem('ventas', JSON.stringify(data));
    render();
  }

  function removeSale(index) {
    data.splice(index, 1);
    toast('Venta eliminada');
    save();
  }

  function sortTable(col) {
    const key = ['nombre', 'codigo', 'precio', 'cantidad', 'total'][col];
    data.sort((a, b) => sortDirection ? (a[key] > b[key] ? 1 : -1) : (a[key] < b[key] ? 1 : -1));
    sortDirection = !sortDirection;
    render();
  }

  function exportExcel() {
    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Ventas');
    XLSX.writeFile(wb, 'VENTAS_TOBIAS.xlsx');
  }

  function exportDocx() {
    const date = new Date().toLocaleString();
    let content = `
      <w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">
        <w:body>
          <w:p><w:r><w:t>Ventas realizadas - ${date}</w:t></w:r></w:p>
          <w:p><w:r><w:t>Producto | C√≥digo | Precio | Cantidad | Total</w:t></w:r></w:p>`;
    data.forEach(r => {
      content += `<w:p><w:r><w:t>${r.nombre} | ${r.codigo} | $${r.precio.toFixed(2)} | ${r.cantidad} | $${r.total.toFixed(2)}</w:t></w:r></w:p>`;
    });
    content += `</w:body></w:document>`;

    const zip = new PizZip();
    zip.file("word/document.xml", content);
    const doc = new docxtemplater(zip);
    const out = doc.getZip().generate({ type: "blob" });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(out);
    link.download = 'VENTAS_TOBIAS.docx';
    link.click();
  }

  function copyTable() {
    const csv = data.map(r => `${r.nombre},${r.codigo},${r.precio},${r.cantidad},${r.total}`).join('\n');
    navigator.clipboard.writeText('Producto,C√≥digo,Precio,Cantidad,Total\n' + csv);
    toast('Tabla copiada al portapapeles');
  }

  function clearAll() {
    if (confirm('¬øVaciar todas las ventas?')) {
      data = [];
      toast('Lista vaciada');
      save();
    }
  }

  function render() {
    const list = document.getElementById('list');
    const search = document.getElementById('search').value.toLowerCase();
    const filtered = data.filter(r =>
      Object.values(r).some(v => String(v).toLowerCase().includes(search))
    );

    list.innerHTML = filtered.map((r, i) => `
      <tr>
        <td>${r.nombre}</td>
        <td>${r.codigo}</td>
        <td>$${r.precio.toFixed(2)}</td>
        <td>${r.cantidad}</td>
        <td>$${r.total.toFixed(2)}</td>
        <td><button class="icon" onclick="removeSale(${i})">√ó</button></td>
      </tr>
    `).join('');

    const total = filtered.reduce((s, r) => s + r.total, 0);
    document.getElementById('total').textContent = `$${total.toFixed(2)}`;
  }

  document.getElementById('search').addEventListener('input', render);
  render();
</script>
</body>
</html>
