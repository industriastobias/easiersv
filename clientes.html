<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Clientes</title>
<style>
  :root{--c:#222;--l:#ddd}
  *{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
  body{background:#fff;color:var(--c);padding:3rem 1rem;line-height:1.55}
  h1{font-size:1.5rem;font-weight:600;margin-bottom:2rem}
  input,button{font-size:1rem;padding:.6rem .8rem;border:1px solid var(--l);border-radius:4px;background:#fff;color:var(--c)}
  input:focus{outline:none;border-color:var(--c)}
  button{cursor:pointer;background:var(--c);color:#fff;border-color:var(--c)}
  button:disabled{opacity:.4;cursor:not-allowed}
  form{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));margin-bottom:2rem}
  .filters{display:flex;flex-wrap:gap;gap:1rem;margin-bottom:1.5rem}
  table{width:100%;border-collapse:collapse}
  th,td{padding:.75rem;text-align:left;border-bottom:1px solid var(--l)}
  th{font-weight:600}
  .actions{display:flex;gap:.5rem}
  .actions button{width:32px;height:32px;padding:0;font-size:1.2rem;background:none;color:var(--c);border:1px solid var(--l)}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.25s}
  .modal.active{opacity:1;pointer-events:auto}
  .modal-content{background:#fff;padding:2rem;border-radius:4px;width:90%;max-width:320px}
  .notification{position:fixed;bottom:1.5rem;right:1.5rem;background:var(--c);color:#fff;padding:.75rem 1.25rem;border-radius:4px;opacity:0;transform:translateY(10px);transition:.3s}
  .notification.show{opacity:1;transform:none}
</style>
</head>
<body>
  <h1>Clientes</h1>

  <form id="form-cliente">
    <input id="cliente-id" placeholder="ID (ej. ABC123)" required>
    <input id="cliente-correo" type="email" placeholder="correo@ejemplo.com" required>
    <input id="cliente-telefono" type="tel" placeholder="Celular" required>
    <button id="btn-guardar">Agregar</button>
  </form>

  <div class="filters">
    <input id="filtro-id" placeholder="Filtrar ID">
    <input id="filtro-correo" type="email" placeholder="Filtrar correo">
    <input id="filtro-telefono" type="tel" placeholder="Filtrar celular">
  </div>

  <table>
    <thead>
      <tr><th>ID</th><th>Correo</th><th>Celular</th><th>Puntos</th><th>Registro</th><th></th></tr>
    </thead>
    <tbody id="clientes-table"></tbody>
  </table>

  <div class="modal" id="modal-overlay">
    <div class="modal-content">
      <h2 style="margin-bottom:1rem;font-size:1.2rem">Modificar puntos</h2>
      <input id="input-puntos" type="number" min="1" placeholder="Cantidad">
      <div style="display:flex;gap:.5rem;margin-top:1rem">
        <button id="btn-sumar">Sumar</button>
        <button id="btn-quitar">Quitar</button>
        <button id="btn-cerrar" class="btn-secondary" style="background:#fff;color:var(--c)">Cancelar</button>
      </div>
    </div>
  </div>

  <div class="notification" id="notification"></div>

<script>
(()=>{
  const k='clientes'; let cs=JSON.parse(localStorage.getItem(k))||[], ed=null;
  const $=s=>document.querySelector(s);
  const save=()=>localStorage.setItem(k,JSON.stringify(cs));
  const notify=m=>{const n=$('#notification');n.textContent=m;n.classList.add('show');setTimeout(()=>n.classList.remove('show'),2500)};
  const valId=i=>/^[a-zA-Z0-9\-]{1,20}$/.test(i);
  const valEm=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);
  const valT=t=>/^\d{7,15}$/.test(t);
  const render=()=>{
    const fi=$('#filtro-id').value.trim().toLowerCase(),
          fc=$('#filtro-correo').value.trim().toLowerCase(),
          ft=$('#filtro-telefono').value.trim().toLowerCase();
    const fil=cs.filter(c=>c.id.toLowerCase().includes(fi)&&c.correo.toLowerCase().includes(fc)&&c.telefono.toLowerCase().includes(ft));
    $('#clientes-table').innerHTML=fil.map(c=>`<tr>
      <td>${c.id}</td><td>${c.correo}</td><td>${c.telefono}</td><td>${c.puntos}</td><td>${c.fecha}</td>
      <td class="actions">
        <button data-id="${c.id}" class="edit">✎</button>
        <button data-id="${c.id}" class="add">+</button>
        <button data-id="${c.id}" class="sub">−</button>
        <button data-id="${c.id}" class="del">×</button>
      </td></tr>`).join('')||'<tr><td colspan="6" style="text-align:center;color:#888">Sin coincidencias</td></tr>';
  };
  $('#form-cliente').addEventListener('submit',e=>{
    e.preventDefault();
    const i=$('#cliente-id').value.trim(), em=$('#cliente-correo').value.trim(), t=$('#cliente-telefono').value.trim();
    if(!valId(i)){alert('ID inválido');return}
    if(!valEm(em)){alert('Correo inválido');return}
    if(!valT(t)){alert('Celular inválido');return}
    if(ed){
      const c=cs.find(x=>x.id===ed); c.correo=em;c.telefono=t;notify('Actualizado');ed=null;$('#btn-guardar').textContent='Agregar';$('#cliente-id').disabled=false;
    }else{
      if(cs.some(x=>x.id===i)){alert('ID duplicado');return}
      cs.push({id:i,correo:em,telefono:t,puntos:0,fecha:new Date().toLocaleDateString()});notify('Agregado');
    }
    save(); e.target.reset(); render();
  });
  $('#clientes-table').addEventListener('click',e=>{
    const b=e.target.closest('button'); if(!b)return; const id=b.dataset.id, c=cs.find(x=>x.id===id);
    if(!c)return;
    if(b.classList.contains('edit')){ed=id;$('#cliente-id').value=id;$('#cliente-correo').value=c.correo;$('#cliente-telefono').value=c.telefono;$('#cliente-id').disabled=true;$('#btn-guardar').textContent='Actualizar';window.scrollTo(0,0)}
    if(b.classList.contains('del')&&confirm(`¿Eliminar ${id}?`)){cs=cs.filter(x=>x.id!==id);save();render();if(ed===id){ed=null;$('#form-cliente').reset();$('#btn-guardar').textContent='Agregar';$('#cliente-id').disabled=false}}
    if(b.classList.contains('add')||b.classList.contains('sub')){const m=$('#modal-overlay');m.dataset.id=id;m.dataset.act=b.classList.contains('add')?'sum':'res';m.classList.add('active');$('#input-puntos').value='';$('#input-puntos').focus()}
  });
  $('#btn-cerrar').onclick=()=>$('#modal-overlay').classList.remove('active');
  ['#btn-sumar','#btn-quitar'].forEach((s,i)=>{
    $(s).onclick=()=>{
      const cant=parseInt($('#input-puntos').value), m=$('#modal-overlay'), id=m.dataset.id, c=cs.find(x=>x.id===id);
      if(isNaN(cant)||cant<1){alert('Cantidad inválida');return}
      if(i===0){c.puntos+=cant;notify(`+${cant}`)}else{if(cant>c.puntos){alert('Puntos insuficientes');return}c.puntos-=cant;notify(`-${cant}`)}
      save();render();m.classList.remove('active');
    }
  });
  ['#filtro-id','#filtro-correo','#filtro-telefono'].forEach(s=>$(s).addEventListener('input',render));
  render();
})();
</script>
</body>
</html>
